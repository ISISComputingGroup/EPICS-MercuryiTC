# MACROS for IOC
# P - base name for IOC
# MIN_PRESSURE

record(mbbo, "$(P)VTI_SPC:STATEMACHINE:STATE")
{
    field(DESC, "Statemachine state")
    field(ZRST, "init")
    field(ONST, "calc_new_sp")
    field(TWST, "set_delay")
    field(THST, "polling_delay")
    field(FRST, "error_delay")
}

record(bo, "$(P)VTI_SPC:STATEMACHINE:STATUS")
{
    field(DESC, "Whether the statemachine is enabled")
    field(ZNAM, "Off")
    field(ONAM, "On")
}

record(mbbo, "$(P)VTI_SPC:STATEMACHINE:ERROR")
{
    field(DESC, "Confguration errors for VTI SPC")
    field(ZRST, "No errors")
    field(ZRSV, "NO_ALARM")

    field(ONST, "Min Pressure > Max")
    field(ONSV, "INVALID")

    field(TWST, "Temp read failure")
    field(TWSV, "MINOR")

    field(THST, "Invalid pressure card")
    field(THSV, "MINOR")

    field(PINI, "YES")

    info(interest, "HIGH")
    info(archive, "VAL SEVR")
    info(alarm, "VTISPC")
}

record(stringin, "$(P)VTI_SPC:PRESSURE_ID")
{
    field(DESC, "ID of controlled pressure card")
    field(VAL,  "$(PRESSURE_CARD_ID)")
    field(PINI, "YES")
}

record(ao, "$(P)VTI_SPC:SET_DELAY")
{
    field(DESC, "Delay between pressure sp updates")
    field(VAL,  "$(SET_DELAY)")
    field(PINI, "YES")
}

record(ao, "$(P)VTI_SPC:POLL_DELAY")
{
    field(DESC, "Delay when pressure not changed")
    field(VAL,  "1")
    field(PINI, "YES")
}

record(ao, "$(P)VTI_SPC:ERROR_DELAY")
{
    field(DESC, "Delay when temp readback fails")
    field(VAL,  "5")
    field(PINI, "YES")
}

record(ao, "$(P)VTI_SPC:TEMP:CUTOFF")
{
    field(DESC, "Constant vs linear interpolation switch")
    field(VAL,  "$(TEMP_CUTOFF_POINT)")
    field(PINI, "YES")
}

record(ao, "$(P)VTI_SPC:TEMP:SCALE")
{
    field(DESC, "Scaling factor for temp calculations")
    field(VAL,  "$(TEMP_SCALE)")
    field(PINI, "YES")
}

record(ao, "$(P)VTI_SPC:PRESSURE:SP:MIN")
{
    field(DESC, "Minimum pressure allowed by user")
    field(VAL,  "$(MIN_PRESSURE)")
    field(PINI, "YES")
}

record(ao, "$(P)VTI_SPC:PRESSURE:SP:MAX")
{
    field(DESC, "Maximum pressure allowed by user")
    field(VAL,  "$(MAX_PRESSURE)")
    field(PINI, "YES")
}

record(cvt, "$(P)VTI_SPC:PRESSURE:SP:MAX:LKUP")
{
    field(SCAN, "Passive")
    field(DESC, "Max pressure based on temp lookup")
    field(INPX, "$(P)$(TEMP_CARD):TEMP CP MSS")
    field(METH, "1D TABLE")
    field(SPEC, "$(PRESSURE_MAX_LKUP=None.txt)")
    field(TDIR, "$(SDIR)")
    field(BDIR, "$(CALIB_BASE_DIR)")
    field(PREC, "3")
    field(EGU, "mbar")
    info(archive, "VAL")
}

record(ao, "$(P)VTI_SPC:PRESSURE:CONST")
{
    field(DESC, "Constant pressure used when below cutoff")
    field(VAL,  "$(PRESSURE_CONSTANT)")
    field(PINI, "YES")
}
